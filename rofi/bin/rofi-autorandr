#!/bin/bash

# Rotate through three possible screen configurations, "lap", "schreibtisch", "schreibtisch2"
# This script is called by the keyboard shortcut Super+Shift+A

current=$(autorandr --current)

# If current is empty, try instead to get the value from /tmp/rixx-autorandr-layout
if [ -z "$current" ]; then
    current=$(cat /tmp/rixx-autorandr-layout)
fi

echo "Current configuration: $current"

# Try to switch to the next possible configuration.

if [ "$current" == "lap" ]; then
    new="schreibtisch"
elif [ "$current" == "schreibtisch" ]; then
    new="schreibtisch2"
elif [ "$current" == "schreibtisch2" ]; then
    new="lap"
else
    new="lap"
fi

autorandr --load $new

# If an error occurs, switch to the one after that. Failing that, switch to the first one.

if [ $? -ne 0 ]; then
    if [ "$current" == "lap" ]; then
        new="schreibtisch2"
    elif [ "$current" == "schreibtisch" ]; then
        new="lap"
    elif [ "$current" == "schreibtisch2" ]; then
        new="schreibtisch"
    else
        new="lap"
    fi
fi

autorandr --load $new

# If an error occurs again, switch to the safe option.
if [ $? -ne 0 ]; then
    autorandr --load lap
    new="lap"
fi

# If an error occurs again, do nothing.
if [ $? -ne 0 ]; then
    echo "Error: Could not switch to any configuration."
else
    echo $new > /tmp/rixx-autorandr-layout
fi
