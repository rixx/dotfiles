#!/bin/bash

set -e

UPLOAD=true
while [[ $# -gt 0 ]]; do
    case $1 in
        -n|--no-upload)
            UPLOAD=false
            shift
            ;;
        *)
            shift
            ;;
    esac
done

SCREENSHOT_PATH=/home/rixx/tmp/screenshots/$(date --iso-8601=seconds).png

slurp | grim -g - - | tee "$SCREENSHOT_PATH" | wl-copy

if [ -f "$SCREENSHOT_PATH" ] && [ ! -s "$SCREENSHOT_PATH" ]; then
    rm "$SCREENSHOT_PATH"
    exit 0
fi

if [ -f "$SCREENSHOT_PATH" ] && [ "$UPLOAD" = true ]; then
    url=$(fb "$SCREENSHOT_PATH")
    notify-send "Uploaded $SCREENSHOT_PATH to $url" -i "$SCREENSHOT_PATH" -a filebin
fi
